# auto generated by wconan2
default:
  name: WCDB
  version: ${date}.${git.short_commit_id}
  build_types: static, shared
  build_configs: release

  dependencies:
    openssl: 1.1.1l

  dependency_options:
    shared:
      default: false

  download:
    dir: wconan_libs
    recursive: true

  build: &default_build_config
    system: cmake
    path: ../tools/version
    arguments:

  outputs:
    headers: [ wconan_build/export_headers ]


android:
  options:
    auto_synthesis_aar: true

  build:
    <<: *default_build_config
    api_level: 21


ios:
  build_types: static
  build:
    system: custom
    # Build static lib. Add one more line with "ObjC" replaced by "Swift" to build swift version
    script: |-
      ../tools/version/build.sh -p iOS -l ObjC -c Release -d wconan_build/ios/release/static --wechat --disable-bitcode --static-framework

  dependencies:

  scripts:
    pre_build: 'rm -r ${yaml_dir}/wconan_build/ios/release'
    post_build: |-
      mkdir -p ${yaml_dir}/wconan_build/ios/release/static/output && \
      mv ${yaml_dir}/wconan_build/ios/release/static/WCDB.framework ${yaml_dir}/wconan_build/ios/release/static/output/

  outputs:
    release_static:
      all: wconan_build/ios/release/static/output


macos:
  build_types: static
  build:
    system: custom
    # build static lib
    script: |-
      ../tools/version/build.sh -p macOS -l Cpp -c Release -d wconan_build/macos/release/static --wechat --disable-bitcode --static-framework

  dependencies:

  scripts:
    pre_build: 'rm -r ${yaml_dir}/wconan_build/macos/release'
    post_build: |-
      mkdir -p ${yaml_dir}/wconan_build/macos/release/static/output && \
      mv ${yaml_dir}/wconan_build/macos/release/static/WCDB.framework ${yaml_dir}/wconan_build/macos/release/static/output/

  outputs:
    release_static:
      all: wconan_build/macos/release/static/output


watchos:
  build_types: static
  build:
    system: custom
    # build static lib
    script: |-
      ../tools/version/build.sh -p watchOS -l ObjC -c Release -d wconan_build/watchos/release/static --wechat --static-framework

  dependencies:

  scripts:
    pre_build: 'rm -r ${yaml_dir}/wconan_build/watchos/release'
    post_build: |-
      mkdir -p ${yaml_dir}/wconan_build/watchos/release/static/output && \
      mv ${yaml_dir}/wconan_build/watchos/release/static/WCDB.framework ${yaml_dir}/wconan_build/watchos/release/static/output/

  outputs:
    release_static:
      all: wconan_build/watchos/release/static/output


macos-all:
  build_types: shared, static
  build:
    system: custom
    # build static lib
    script: |-
      ../tools/version/build.sh -p macOS -l Cpp -c Release -d wconan_build/macos-all/release/shared --wechat --disable-bitcode --universal && \
      ../tools/version/build.sh -p macOS -l Cpp -c Release -d wconan_build/macos-all/release/static --wechat --disable-bitcode --static-framework --universal

  dependencies:

  scripts:
    pre_build: 'rm -r ${yaml_dir}/wconan_build/macos-all/release'
    post_build: |-
      mkdir -p ${yaml_dir}/wconan_build/macos-all/release/shared/output && \
      mv ${yaml_dir}/wconan_build/macos-all/release/shared/WCDB.framework ${yaml_dir}/wconan_build/macos-all/release/shared/output/ && \
      mkdir -p ${yaml_dir}/wconan_build/macos-all/release/static/output && \
      mv ${yaml_dir}/wconan_build/macos-all/release/static/WCDB.framework ${yaml_dir}/wconan_build/macos-all/release/static/output/

  outputs:
    release_shared:
      all: wconan_build/macos-all/release/shared/output
    release_static:
      all: wconan_build/macos-all/release/static/output


# windows:
