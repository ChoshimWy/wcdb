# auto generated by wconan2
default: &default_config
  name: WCDB
  version: 2.0.${date}${time}-${git.short_commit_id}
  build_types: static, shared
  build_configs: release

  dependencies: &default_dependencies
    openssl: 1.1.1l

  dependency_options:
    shared:
      default: false

  download:
    dir: wconan_libs
    recursive: true

  build: &default_build_config
    system: cmake
    path: ../tools/version
    arguments:

  outputs:
    headers: [ export_headers ]


android:
  options:
    auto_synthesis_aar: false

  build: &android_build_config
    <<: *default_build_config
    api_level: 21

  product_flavors:
    generic:
      is_default: true
    ammdev:
      dependencies:
        wcdb-android: 1.0.0
      dependency_options: &default_dependency_options
        shared:
          default: false
          wcdb-android: true
      version_suffix: '-ammdev'
      build:
        <<: *android_build_config
        arguments: '-DFLAVOR_AMMDEV=ON'

ios:
  build_types: static
  build:
    system: custom
    # Build static lib. Add one more line with "ObjC" replaced by "Swift" to build swift version
    script: |-
      ../tools/version/build.sh -p iOS -l All -c Release -d apple_build/ios/release/static --wechat --disable-bitcode --static-framework

  dependencies:

  scripts:
    pre_build: 'rm -rf ${yaml_dir}/apple_build/ios/release'
    post_build: |-
      mkdir -p ${yaml_dir}/apple_build/ios/release/static/output && \
      mv ${yaml_dir}/apple_build/ios/release/static/WCDB.framework ${yaml_dir}/apple_build/ios/release/static/output/

  outputs:
    release_static:
      all: apple_build/ios/release/static/output

watchos:
  build_types: static
  build:
    system: custom
    # build static lib
    script: |-
      ../tools/version/build.sh -p watchOS -l All -c Release -d apple_build/watchos/release/static --wechat --static-framework

  dependencies:

  scripts:
    pre_build: 'rm -rf ${yaml_dir}/apple_build/watchos/release'
    post_build: |-
      mkdir -p ${yaml_dir}/apple_build/watchos/release/static/output && \
      mv ${yaml_dir}/apple_build/watchos/release/static/WCDB.framework ${yaml_dir}/apple_build/watchos/release/static/output/

  outputs:
    release_static:
      all: apple_build/watchos/release/static/output


macos-all:
  build_types: shared, static
  build:
    system: custom
    # build static lib
    script: |-
      ../tools/version/build.sh -p macOS -l Cpp -c Release -d apple_build/macos-all/release/shared --wechat --disable-bitcode --universal && \
      ../tools/version/build.sh -p macOS -l Cpp -c Release -d apple_build/macos-all/release/static --wechat --disable-bitcode --static-framework --universal

  dependencies:

  scripts:
    pre_build: 'rm -rf ${yaml_dir}/apple_build/macos-all/release'
    post_build: |-
      mkdir -p ${yaml_dir}/apple_build/macos-all/release/shared/output && \
      mv ${yaml_dir}/apple_build/macos-all/release/shared/WCDBCpp.framework ${yaml_dir}/apple_build/macos-all/release/shared/output/ && \
      mv ${yaml_dir}/apple_build/macos-all/release/shared/output/WCDBCpp.framework ${yaml_dir}/apple_build/macos-all/release/shared/output/WCDB.framework && \
      mv ${yaml_dir}/apple_build/macos-all/release/shared/output/WCDB.framework/WCDBCpp ${yaml_dir}/apple_build/macos-all/release/shared/output/WCDB.framework/WCDB && \
      mkdir -p ${yaml_dir}/apple_build/macos-all/release/static/output && \
      mv ${yaml_dir}/apple_build/macos-all/release/static/WCDBCpp.framework ${yaml_dir}/apple_build/macos-all/release/static/output/ && \
      mv ${yaml_dir}/apple_build/macos-all/release/static/output/WCDBCpp.framework ${yaml_dir}/apple_build/macos-all/release/static/output/WCDB.framework && \
      mv ${yaml_dir}/apple_build/macos-all/release/static/output/WCDB.framework/WCDBCpp ${yaml_dir}/apple_build/macos-all/release/static/output/WCDB.framework/WCDB

  outputs:
    release_shared:
      all: apple_build/macos-all/release/shared/output
    release_static:
      all: apple_build/macos-all/release/static/output


# windows:

#linux
linux-x86_64-gcc-5.4.0: &linux_config
  dependencies:
    <<: *default_dependencies
    zlib: 1.2.11


linux-arm64-gcc-linaro-7.5.0:
  <<: *linux_config


mips-loongson-linux-gnu:
  <<: *linux_config


loongarch64-linux-gnu:
  <<: *linux_config

